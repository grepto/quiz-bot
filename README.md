# Чат-боты для викторин Вконтакте и Телеграме
Боты задают вопросы, проверяют ответы, ведут счет.

Демо боты
 - [Телеграм-бот @notification_9000_bot](https://t.me/notification_9000_bot)
 - Сообщения в [тестовой группе Вконтакте](https://vk.com/club182798277)


### Как установить
Для работы скрипта нужно зарегистрировать в операционной системе переменные окружения

- `TG_TOKEN` - Токен бота в телеграме
- `TG_CHAT_ID` - @Идентификатор телеграмм-чата или пользователя куда будут приходить сообщения об ошибках
(например @smmreposting)

- `VK_GROUP_TOKEN` - токен доступа к группе Вконтакте. При регистрации нужно будет дать права работу с сообщениями.

- `REDIS_HOST` - адрес инстанса в сервисе redislabs.com
- `REDIS_PORT` - порт
- `REDIS_PASWORD` - пароль от базы

- `LOG_LEVEL` - уровень логирования (NOTSET, DEBUG, INFO, WARNING, ERROR, CRITICAL). Подробно о каждом уровне

Если телеграм-бот не запускается из-за блокировок, нужно добавить еще одну переменную окгружения


- `TG_PROXY` - урл прокси сервера через который должен работать телеграм-бот. Рабочий прокси можно взять [на этом сайте](http://spys.one/proxies/)

описано [тут](https://docs.python.org/3/library/logging.html)

 
Python3 должен быть уже установлен.
Затем используйте `pip` (или `pip3`, есть есть конфликт с Python2) для установки зависимостей:
```
pip install -r requirements.txt
```

### Как использовать
Боты запускаются по отдельности. Для каждого бота свой процесс. Для запуска бота нужно запустить `main.py` с ключем
`-startbot`. После ключа нужно передать одно из значений `tg` для запуска телеграм-бота или `vk` для запуска бота
вконтакте

Пример использования
```sh
python main.py -startbot vk
```

```sh
python main.py -startbot tg
```


### Деплой и запуск на Heroku
Бота можно запустить на [Heroku](https://.heroku.com). Нужно создать на Heroku новое приложение, связать его с
репозиторием, задеплоить и сбилдить исходники.

В настройках приложения на heroku (вкладка Settings) нужно добавить в Config Vars переменные окружения и их значения
описанные в разделе Как установить. Чтобы не забивать логи инстанса на heroku, `LOG_LEVEL` лучше выставить значение
`INFO`

После настройки приложение нужно запустить во вкладке `Resource`. Если скрипт запустится корректно, телеграм-бот пришлет
сообщения о запуске ботов вида
```
2019-07-19 10:46:04,236
vk_bot
INFO
VK bot started
```

Если произойдет ошибка бот напишет в телеграм сообщение вида
```
2019-07-19 10:46:05,297
vk_bot
ERROR
[5] User authorization failed: invalid access_token (4).
```

Для управления ботом на Heroku из коммандной строки нужно установить
[heroku cli](https://devcenter.heroku.com/categories/command-line) и авторизоваться из терминала в Heroku

Для проверки статуса приложения из терминала нужно выполнить команду
```sh
heroku ps -a название_приложения_на_heroku
```

### Цель проекта
Код написан в образовательных целях на онлайн-курсе для веб-разработчиков dvmn.org.